
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>@ViewData["Title"] - IEM</title>
	<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
	<link rel="stylesheet" href="~/phr.styles.css" asp-append-version="true" />
</head>
<body class="bg-light">
	<header>
		@* <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
		<div class="container">
		<a class="navbar-brand" asp-area="" asp-page="/Index">phr</a>
		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
		aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
		</button>
		<div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
		<ul class="navbar-nav flex-grow-1">
		<li class="nav-item">
		<a class="nav-link text-dark" asp-area="" asp-page="/Index">Home</a>
		</li>
		<li class="nav-item">
		<a class="nav-link text-dark" asp-area="" asp-page="/Privacy">Privacy</a>
		</li>
		</ul>
		<partial name="_LoginPartial" />
		</div>
		</div>
		</nav>
		</header>
		<div class="container">
		<main role="main" class="pb-3">
		@RenderBody()
		</main>
		</div> *@

		<div class="offcanvas offcanvas-start w-80" tabindex="-1" id="offcanvas">
			<div class="offcanvas-header">
				<h6 class="offcanvas-title d-none d-sm-block" id="offcanvas">Menu</h6>
				<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
			</div>
			<div class="offcanvas-body px-0">
				<ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-start" id="menu">
					<li class="nav-item">
						<a class="nav-link text-truncate" asp-area="" asp-page="/Index">
							<i class="fs-5 bi-house"></i><span class="ms-1 d-sm-inline">Beranda</span>
						</a>
					</li>
					<li>
						<a class="nav-link text-truncate" asp-page="/Exceptions/Exception">
							<i class="fs-5 bi-info-circle"></i><span class="ms-1 d-sm-inline">Exeption Signals</span>
						</a>
					</li>
					<li>
						<a class="nav-link text-truncate" asp-page="/Passed/Passed">
							<i class="fs-5 bi-reception-4"></i><span class="ms-1 d-sm-inline">Passed Signals</span>
						</a>
					</li>
					<li>
						<a class="nav-link text-truncate" asp-page="/Notification">
							<i class="fs-5 bi-bell"></i><span class="ms-1 d-sm-inline">Notifikasi</span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</header>
	<!-- toggler -->
	<button class="btn float-start" data-bs-toggle="offcanvas" data-bs-target="#offcanvas" role="button">
		<i class="bi bi-list fs-3 text-secondary" data-bs-toggle="offcanvas" data-bs-target="#offcanvas"></i>
	</button>
	@RenderBody()

	@* <footer class="border-top footer text-muted bg-white">
	<div class="container">
	&copy; 2024 - phr - <a asp-area="" asp-page="/Privacy">Privacy</a>
	</div>
	</footer> *@
	<script>
		async function initServiceWorker() {

			if ('serviceWorker' in navigator) {

				const swRegistration = await navigator.serviceWorker.register('/js/site.js');



				// Check if the user is already subscribed

				const subscription = await swRegistration.pushManager.getSubscription();



				if (subscription) {

					console.log('User  is already subscribed:', subscription);

					// Optionally send the subscription to your server

					sendSubscriptionToServer(subscription);

				} else {

					// User is not subscribed, prompt for subscription

					subscribeUser (swRegistration);

				}

			} else {

				console.warn('Service worker is not supported');

			}

		}


		async function subscribeUser (swRegistration) {

			try {

				const subscription = await swRegistration.pushManager.subscribe({

					userVisibleOnly: true,

					applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)

				});

				console.log('User  subscribed:', subscription);

				// Send the subscription to your server

				sendSubscriptionToServer(subscription);

			} catch (error) {

				console.error('Failed to subscribe user:', error);

			}

		}


		function sendSubscriptionToServer(subscription) {
			var userId = "1232"
			fetch('https://a090-202-43-95-42.ngrok-free.app/subscribe', {

				method: 'POST',

				body: JSON.stringify({userId: userId,subscription:subscription}),

				headers: {

					'Content-Type': 'application/json'

				}

			})

			.then(response => {

				if (!response.ok) {

					throw new Error('Failed to send subscription to server');

				}

				return response.json();

			})

			.then(data => {

				console.log('Subscription sent to server:', data);

			})

			.catch(error => {

				console.error('Error sending subscription to server:', error);

			});

		};
		
		function urlBase64ToUint8Array(base64String) {

			const padding = '='.repeat((4 - base64String.length % 4) % 4);

			const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');

			const rawData = window.atob(base64);

			return new Uint8Array([...rawData].map(char => char.charCodeAt(0)));

		};

		window.addEventListener('load', () => {

			initServiceWorker();

		});
	</script>
	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<script src="~/js/site.js" asp-append-version="true"></script>

	@await RenderSectionAsync("Scripts", required: false)
</body>
</html>